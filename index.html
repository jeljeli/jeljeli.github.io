<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>T√©l√©travail ou Sur Site ?</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --teletravail: #0d9488;
    --onsite: #7c3aed;
    --bg: #0f0f13;
    --surface: #1a1a24;
    --border: #2a2a3a;
    --text: #e8e8f0;
    --muted: #6b6b88;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem 1rem 3rem;
    position: relative;
    overflow-x: hidden;
    -webkit-text-size-adjust: 100%;
  }

  body::before {
    content: '';
    position: fixed;
    top: -30%;
    left: -20%;
    width: 60%;
    height: 60%;
    background: radial-gradient(ellipse, rgba(13,148,136,0.12) 0%, transparent 70%);
    pointer-events: none;
  }

  body::after {
    content: '';
    position: fixed;
    bottom: -30%;
    right: -20%;
    width: 60%;
    height: 60%;
    background: radial-gradient(ellipse, rgba(124,58,237,0.1) 0%, transparent 70%);
    pointer-events: none;
  }

  .container {
    width: 100%;
    max-width: 560px;
    position: relative;
    z-index: 1;
  }

  h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2rem, 8vw, 3rem);
    line-height: 1.1;
    margin-bottom: 0.4rem;
    letter-spacing: -0.02em;
  }

  .subtitle {
    color: var(--muted);
    font-size: 0.9rem;
    font-weight: 300;
    margin-bottom: 2rem;
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.4rem;
    margin-bottom: 1rem;
  }

  .card-title {
    font-size: 0.72rem;
    font-weight: 500;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 1rem;
  }

  /* R√©f√©rence : empil√© sur mobile */
  .reference-row {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  label {
    display: block;
    font-size: 0.82rem;
    color: var(--muted);
    margin-bottom: 0.45rem;
    font-weight: 400;
  }

  /* Input date styl√© ‚Äî compatible iOS */
  input[type="date"] {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem; /* ‚â•16px √©vite le zoom iOS */
    padding: 0.85rem 1rem;
    outline: none;
    transition: border-color 0.2s;
    cursor: pointer;
    -webkit-appearance: none;
    appearance: none;
    min-height: 48px; /* zone tactile minimum */
  }

  input[type="date"]:focus {
    border-color: var(--teletravail);
  }

  /* Correctif couleur placeholder sur iOS */
  input[type="date"]::-webkit-datetime-edit { color: var(--text); }
  input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(0.6);
    cursor: pointer;
    padding: 4px;
  }

  .mode-selector {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.6rem;
  }

  .mode-btn {
    padding: 0.85rem 0.5rem;
    border-radius: 10px;
    border: 1.5px solid var(--border);
    background: transparent;
    color: var(--muted);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 400;
    min-height: 48px;
    -webkit-tap-highlight-color: transparent;
  }

  .mode-btn:active {
    opacity: 0.75;
  }

  .mode-btn.active-teletravail {
    border-color: var(--teletravail);
    background: rgba(13,148,136,0.12);
    color: #5eead4;
  }

  .mode-btn.active-onsite {
    border-color: var(--onsite);
    background: rgba(124,58,237,0.12);
    color: #c4b5fd;
  }

  /* V√©rifier : input + bouton c√¥te √† c√¥te */
  .check-row {
    display: flex;
    gap: 0.75rem;
    align-items: flex-end;
  }

  .check-row > div:first-child {
    flex: 1;
    min-width: 0;
  }

  .btn-check {
    padding: 0.85rem 1.2rem;
    border-radius: 10px;
    border: none;
    background: var(--teletravail);
    color: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
    white-space: nowrap;
    min-height: 48px;
    flex-shrink: 0;
    -webkit-tap-highlight-color: transparent;
  }

  .btn-check:active { transform: scale(0.96); opacity: 0.85; }

  .result {
    display: none;
    padding: 1.4rem;
    border-radius: 16px;
    border: 1.5px solid;
    animation: fadeUp 0.35s ease;
    margin-top: 0.25rem;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .result.teletravail {
    background: rgba(13,148,136,0.08);
    border-color: rgba(13,148,136,0.4);
  }

  .result.onsite {
    background: rgba(124,58,237,0.08);
    border-color: rgba(124,58,237,0.4);
  }

  .result-icon { font-size: 2.2rem; margin-bottom: 0.4rem; }

  .result-day {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(1.1rem, 4.5vw, 1.5rem);
    margin-bottom: 0.25rem;
    word-break: break-word;
  }

  .result-mode { font-size: 1rem; font-weight: 500; }
  .result.teletravail .result-mode { color: #5eead4; }
  .result.onsite .result-mode { color: #c4b5fd; }

  .result-note {
    font-size: 0.82rem;
    color: var(--muted);
    margin-top: 0.35rem;
  }

  .error {
    color: #f87171;
    font-size: 0.85rem;
    margin-top: 0.6rem;
    display: none;
  }

  .week-preview {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.35rem;
    margin-top: 0.75rem;
  }

  .week-day {
    border-radius: 8px;
    padding: 0.45rem 0.15rem;
    text-align: center;
    font-size: 0.68rem;
    border: 1px solid var(--border);
  }

  .week-day .wd-name { font-weight: 500; margin-bottom: 0.2rem; color: var(--muted); }
  .week-day .wd-status { font-size: 0.9rem; }

  .week-day.tt { background: rgba(13,148,136,0.1); border-color: rgba(13,148,136,0.3); }
  .week-day.os { background: rgba(124,58,237,0.1); border-color: rgba(124,58,237,0.3); }
  .week-day.tt .wd-status { color: #5eead4; }
  .week-day.os .wd-status { color: #c4b5fd; }
  .week-day.highlighted { outline: 2px solid white; outline-offset: 1px; }

  .preview-title {
    font-size: 0.72rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-top: 1.1rem;
    margin-bottom: 0.4rem;
  }
</style>
</head>
<body>
<div class="container">
  <h1>T√©l√©travail<br><em>ou Sur Site ?</em></h1>
  <p class="subtitle">Indiquez un jour de r√©f√©rence et consultez n'importe quel jour.</p>

  <div class="card">
    <div class="card-title">üìç Jour de r√©f√©rence</div>
    <div class="reference-row">
      <div>
        <label>Date connue</label>
        <input type="date" id="refDate">
      </div>
      <div>
        <label>Mode ce jour-l√†</label>
        <div class="mode-selector">
          <button class="mode-btn active-teletravail" id="btnTT" onclick="setMode('teletravail')">üè† T√©l√©travail</button>
          <button class="mode-btn" id="btnOS" onclick="setMode('onsite')">üè¢ Sur site</button>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">üîç Jour √† v√©rifier</div>
    <div class="check-row">
      <div>
        <label>Date √† consulter</label>
        <input type="date" id="checkDate">
      </div>
      <button class="btn-check" onclick="checkDay()">V√©rifier ‚Üí</button>
    </div>
    <div class="error" id="error">Veuillez remplir tous les champs et choisir un jour ouvr√© (lun-ven).</div>
  </div>

  <div class="result" id="result">
    <div class="result-icon" id="resultIcon"></div>
    <div class="result-day" id="resultDay"></div>
    <div class="result-mode" id="resultMode"></div>
    <div class="result-note" id="resultNote"></div>
    <div class="preview-title">Semaine compl√®te</div>
    <div class="week-preview" id="weekPreview"></div>
  </div>
</div>

<script>
  let selectedMode = 'teletravail';
  const DAYS_FR = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];

  const today = new Date();
  const fmt = d => d.toISOString().split('T')[0];
  document.getElementById('refDate').value = fmt(today);
  document.getElementById('checkDate').value = fmt(today);

  function setMode(mode) {
    selectedMode = mode;
    document.getElementById('btnTT').className = 'mode-btn' + (mode === 'teletravail' ? ' active-teletravail' : '');
    document.getElementById('btnOS').className = 'mode-btn' + (mode === 'onsite' ? ' active-onsite' : '');
  }

  function getMode(targetDate, refDate, refMode) {
    const msPerDay = 86400000;
    const refDay = refDate.getDay();
    const targetDay = targetDate.getDay();

    const refMonday = new Date(refDate);
    refMonday.setDate(refDate.getDate() - ((refDay + 6) % 7));

    const targetMonday = new Date(targetDate);
    targetMonday.setDate(targetDate.getDate() - ((targetDay + 6) % 7));

    const weeksDiff = Math.round((targetMonday - refMonday) / (7 * msPerDay));
    const sameWeekParity = (weeksDiff % 2 === 0);

    function modeForDayInPattern(dayOfWeek, patternA) {
      const isFirstHalf = dayOfWeek <= 3;
      if (patternA) return isFirstHalf ? 'onsite' : 'teletravail';
      else return isFirstHalf ? 'teletravail' : 'onsite';
    }

    const refDayWeek = ((refDay + 6) % 7) + 1;
    let refIsPatternA;
    if (refDayWeek >= 1 && refDayWeek <= 5) {
      const modeIfA = modeForDayInPattern(refDayWeek, true);
      refIsPatternA = (modeIfA === refMode);
    } else {
      refIsPatternA = true;
    }

    const targetIsPatternA = sameWeekParity ? refIsPatternA : !refIsPatternA;
    const targetDayWeek = ((targetDay + 6) % 7) + 1;
    return modeForDayInPattern(targetDayWeek, targetIsPatternA);
  }

  function checkDay() {
    const err = document.getElementById('error');
    err.style.display = 'none';

    const refVal = document.getElementById('refDate').value;
    const checkVal = document.getElementById('checkDate').value;

    if (!refVal || !checkVal) { err.style.display = 'block'; return; }

    const refDate = new Date(refVal + 'T12:00:00');
    const checkDate = new Date(checkVal + 'T12:00:00');
    const refDay = refDate.getDay();
    const chkDay = checkDate.getDay();

    if (refDay === 0 || refDay === 6 || chkDay === 0 || chkDay === 6) {
      err.textContent = 'Veuillez choisir des jours ouvr√©s (lundi √† vendredi).';
      err.style.display = 'block';
      document.getElementById('result').style.display = 'none';
      return;
    }

    const mode = getMode(checkDate, refDate, selectedMode);
    showResult(checkDate, mode);
  }

  function showResult(date, mode) {
    const isTT = mode === 'teletravail';
    const dateStr = date.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

    const result = document.getElementById('result');
    result.className = 'result ' + mode;
    result.style.display = 'block';

    document.getElementById('resultIcon').textContent = isTT ? 'üè†' : 'üè¢';
    document.getElementById('resultDay').textContent = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);
    document.getElementById('resultMode').textContent = isTT ? 'T√©l√©travail' : 'Sur site';
    document.getElementById('resultNote').textContent = isTT ? 'Tu travailles depuis chez toi ce jour.' : 'Tu es au bureau ce jour.';

    const day = date.getDay();
    const monday = new Date(date);
    monday.setDate(date.getDate() - ((day + 6) % 7));

    const refDate = new Date(document.getElementById('refDate').value + 'T12:00:00');
    const preview = document.getElementById('weekPreview');
    preview.innerHTML = '';

    ['Lun','Mar','Mer','Jeu','Ven'].forEach((name, i) => {
      const d = new Date(monday);
      d.setDate(monday.getDate() + i);
      const m = getMode(d, refDate, selectedMode);
      const isTarget = d.toDateString() === date.toDateString();
      const div = document.createElement('div');
      div.className = 'week-day ' + (m === 'teletravail' ? 'tt' : 'os') + (isTarget ? ' highlighted' : '');
      div.innerHTML = `<div class="wd-name">${name}</div><div class="wd-status">${m === 'teletravail' ? 'üè†' : 'üè¢'}</div>`;
      preview.appendChild(div);
    });

    result.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
</script>
</body>
</html>
